<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Attendance System - Bulk Student Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="{% static 'css/bulkActions/student.css' %}">
</head>

<body>
    {% include "header.html" %}
    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="animate__animated animate__fadeInDown">Student Management System</h1>
            <p class="animate__animated animate__fadeInUp">Manage student records efficiently and effectively</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="f-container">
        <div class="enroll-container">
            <div class="enroll-header">
                <h3>Bulk Student Management</h3>
                <p class="mb-0">Filter and manage multiple students at once</p>
            </div>

            <!-- Messages will appear here -->
            <div id="messageContainer"></div>
            <!-- Alert Messages -->
            {% if messages %}
            <div id="alertContainer">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %}">
                    <i
                        class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %}"></i>
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="filter-section">
                <div class="filter-group">
                    <label for="course"><i class="fas fa-book"></i> Course:</label>
                    <select id="course" class="form-select">
                        <option value="all" selected>All Courses</option>
                        {% for course in courses %}
                        <option value="{{ course }}">{{ course }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label for="year"><i class="fas fa-calendar-alt"></i> Year:</label>
                    <select id="year" class="form-select">
                        <option value="all" selected>All Years</option>
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="semester"><i class="fas fa-calendar-check"></i> Semester:</label>
                    <select id="semester" class="form-select">
                        <option value="all" selected>All Semesters</option>
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                        <option value="4">Semester 4</option>
                        <option value="5">Semester 5</option>
                        <option value="6">Semester 6</option>
                        <option value="7">Semester 7</option>
                        <option value="8">Semester 8</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="college_id"><i class="fas fa-id-card"></i> College ID:</label>
                    <input type="text" id="college_id" class="form-control" placeholder="Enter College ID">
                </div>

                <div class="filter-group">
                    <button id="filterBtn" class="btn-filter w-100">
                        <i class="fas fa-filter"></i> Filter Students
                    </button>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions">
                <input type="checkbox" id="selectAll" class="bulk-select">
                <label for="selectAll">Select All</label>
                <button class="btn btn-primary btn-sm" id="editSelected">
                    <i class="fas fa-edit"></i> Edit Selected
                </button>
                <button class="btn btn-danger btn-sm" id="deleteSelected">
                    <i class="fas fa-trash"></i> Delete Selected
                </button>
                <button class="btn btn-success btn-sm" id="exportSelected">
                    <i class="fas fa-file-export"></i> Export Selected
                </button>
            </div>

            <div class="results-section">
                <div id="loading" class="text-center py-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p>Loading student data...</p>
                </div>

                <div id="results">
                    <div class="table-responsive">
                        <table class="student-table">
                            <thead>
                                <tr>
                                    <th>Select</th>
                                    <th>Profile</th>
                                    <th>College ID</th>
                                    <th>Name</th>
                                    <th>Father's Name</th>
                                    <th>Course</th>
                                    <th>Year/Semester</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                {% for student in students %}
                                <tr id="student-{{ student.college_id }}">
                                    <td><input type="checkbox" class="student-checkbox" data-id="{{ student.college_id }}"></td>
                                    <td>
                                        {% if student.profile_picture %}
                                        <img src="{{ student.profile_picture.url }}" class="avatar" alt="Student">
                                        {% else %}
                                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
                                            class="avatar" alt="Student">
                                        {% endif %}
                                    </td>
                                    <td>{{ student.college_id }}</td>
                                    <td>{{ student.name }} {{ student.last_name }}</td>
                                    <td>{{ student.father_name }}</td>
                                    <td>{{ student.course }}</td>
                                    <td>{{ student.year }} Year / {{ student.semester }} Sem</td>
                                    <td>{{ student.phone }}{% if student.other_phone_no %}, {{ student.other_phone_no }}{% endif %}</td>
                                    <td class="action-buttons">
                                        <a href="#" class="btn-action btn-view" data-id="{{ student.college_id }}">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a class="btn-action btn-edit" data-id="{{ student.college_id }}">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button class="btn-action btn-delete" data-id="{{ student.college_id }}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination will be handled via AJAX -->
                    <div class="pagination" id="pagination">
                        <!-- Pagination will be dynamically generated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Student Modal -->
    <div class="modal fade" id="viewStudentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Student Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewStudentModalBody">
                    <!-- Content will be loaded via AJAX -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="editFromViewBtn">Edit Details</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal fade" id="editStudentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Student Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editStudentForm" method="post" action="{% url 'update_student' %}">
                        {% csrf_token %}
                        <input type="hidden" id="editCollegeId" name="college_id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="editName" name="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editLastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="editLastName" name="last_name" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editFather" class="form-label">Father's Name</label>
                                <input type="text" class="form-control" id="editFather" name="father_name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editMother" class="form-label">Mother's Name</label>
                                <input type="text" class="form-control" id="editMother" name="mother_name" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="editCourse" class="form-label">Course</label>
                                <select class="form-select" id="editCourse" name="course" required>
                                    {% for course in courses %}
                                    <option value="{{ course }}">{{ course }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editYear" class="form-label">Year</label>
                                <select class="form-select" id="editYear" name="year" required>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editSemester" class="form-label">Semester</label>
                                <select class="form-select" id="editSemester" name="semester" required>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="editEmail" name="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editPhone" class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="editPhone" name="phone" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="editAddress" name="address" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveStudentBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Edit Modal -->
    <div class="modal fade" id="bulkEditModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bulk Edit Students</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="bulkEditForm" method="post" action="{% url 'bulk_update_students' %}">
                        {% csrf_token %}
                        <input type="hidden" id="bulkEditIds" name="student_ids">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Only fields with changes will be updated for selected students.
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="bulkEditCourse" class="form-label">Course</label>
                                <select class="form-select" id="bulkEditCourse" name="course">
                                    <option value="">-- No Change --</option>
                                    {% for course in courses %}
                                    <option value="{{ course }}">{{ course }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="bulkEditYear" class="form-label">Year</label>
                                <select class="form-select" id="bulkEditYear" name="year">
                                    <option value="">-- No Change --</option>
                                    <option value="1">1st Year</option>
                                    <option value="2">2nd Year</option>
                                    <option value="3">3rd Year</option>
                                    <option value="4">4th Year</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="bulkEditSemester" class="form-label">Semester</label>
                                <select class="form-select" id="bulkEditSemester" name="semester">
                                    <option value="">-- No Change --</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveBulkEditBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the selected student(s)? This action cannot be undone.</p>
                    <div id="deleteStudentsList"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            var currentPage = 1;
            var totalPages = 1;
            
            // Function to load students with filters and pagination
function loadStudents(page = 1) {
    const course = $('#course').val();
    const year = $('#year').val();
    const semester = $('#semester').val();
    const collegeId = $('#college_id').val();
    
    $('#loading').show();
    $('#results').hide();
    
    $.ajax({
        url: "{% url 'filtered_student' %}",
        type: "GET",
        data: {
            course: course,
            year: year,
            semester: semester,
            college_id: collegeId,
            page: page
        },
        success: function(response) {
            $('#studentTableBody').html(response.html);
            if (response.pagination) {
                $('#pagination').html(response.pagination);
                currentPage = page;
                totalPages = response.total_pages;
            }
            $('#loading').hide();
            $('#results').show();
        },
        error: function(xhr, status, error) {
            $('#loading').hide();
            showMessage('Error loading students: ' + error, 'error');
        }
    });
}
            
            // Filter students
            $('#filterBtn').click(function () {
                loadStudents(1);
            });
            
            // Pagination click handler
            $(document).on('click', '.page-link', function(e) {
                e.preventDefault();
                const page = $(this).data('page');
                if (page && page !== currentPage) {
                    loadStudents(page);
                }
            });
            
            // View student details
            $(document).on('click', '.btn-view', function () {
                const studentId = $(this).data('id');
                
                $.ajax({
                    url: "{% url 'get_student_details' %}",
                    type: "GET",
                    data: { college_id: studentId },
                    success: function(response) {
                        if (response.success) {
                            const student = response.student;
                            const modalContent = `
                                <div class="row">
                                    <div class="col-md-4 text-center">
                                        ${student.profile_picture ? 
                                            `<img src="${student.profile_picture}" class="img-fluid rounded-circle mb-3" alt="Student">` : 
                                            `<img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="img-fluid rounded-circle mb-3" alt="Student">`
                                        }
                                        <h4>${student.name} ${student.last_name}</h4>
                                        <p class="text-muted">${student.course} - ${student.level}</p>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <strong>College ID:</strong> <span>${student.college_id}</span>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Email:</strong> <span>${student.email}</span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <strong>Father's Name:</strong> <span>${student.father_name}</span>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Mother's Name:</strong> <span>${student.mother_name}</span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <strong>Year/Semester:</strong> <span>${student.year} Year / ${student.semester} Semester</span>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Date of Birth:</strong> <span>${student.birthday}</span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <strong>Address:</strong>
                                                <span>${student.address}, ${student.city}, ${student.state}, India - ${student.pin_code}</span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <strong>Phone:</strong> <span>+91 ${student.phone}</span>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Joined:</strong> <span>${student.date_of_joining}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            $('#viewStudentModalBody').html(modalContent);
                            $('#viewStudentModal').data('id', studentId);
                            $('#viewStudentModal').modal('show');
                        } else {
                            showMessage(response.error, 'error');
                        }
                    },
                    error: function(xhr, status, error) {
                        showMessage('Error loading student details: ' + error, 'error');
                    }
                });
            });
            
            // Edit student from view modal
            $('#editFromViewBtn').click(function() {
                const studentId = $('#viewStudentModal').data('id');
                $('#viewStudentModal').modal('hide');
                loadStudentForEdit(studentId);
            });
            
            // Edit student
            $(document).on('click', '.btn-edit', function () {
                const studentId = $(this).data('id');
                loadStudentForEdit(studentId);
            });
            
            function loadStudentForEdit(studentId) {
                $.ajax({
                    url: "{% url 'get_student_details' %}",
                    type: "GET",
                    data: { college_id: studentId },
                    success: function(response) {
                        if (response.success) {
                            const student = response.student;
                            $('#editCollegeId').val(student.college_id);
                            $('#editName').val(student.name);
                            $('#editLastName').val(student.last_name);
                            $('#editFather').val(student.father_name);
                            $('#editMother').val(student.mother_name);
                            $('#editCourse').val(student.course);
                            $('#editYear').val(student.year);
                            $('#editSemester').val(student.semester);
                            $('#editEmail').val(student.email);
                            $('#editPhone').val(student.phone);
                            $('#editAddress').val(student.address);
                            
                            $('#editStudentModal').data('id', studentId);
                            $('#editStudentModal').modal('show');
                        } else {
                            showMessage(response.error, 'error');
                        }
                    },
                    error: function(xhr, status, error) {
                        showMessage('Error loading student details: ' + error, 'error');
                    }
                });
            }
            
            // Save edited student
            $('#saveStudentBtn').click(function () {
                const formData = $('#editStudentForm').serialize();
                
                $.ajax({
                    url: "{% url 'update_student' %}",
                    type: "POST",
                    data: formData,
                    success: function(response) {
                        if (response.success) {
                            $('#editStudentModal').modal('hide');
                            showMessage(response.message, 'success');
                            loadStudents(currentPage);
                        } else {
                            showMessage(response.error, 'error');
                        }
                    },
                    error: function(xhr, status, error) {
                        showMessage('Error updating student: ' + error, 'error');
                    }
                });
            });
            
            // Delete student
            $(document).on('click', '.btn-delete', function () {
                const studentId = $(this).data('id');
                const studentName = $(this).closest('tr').find('td:eq(3)').text();

                $('#deleteStudentsList').html(`<p><strong>${studentName}</strong> (ID: ${studentId})</p>`);
                $('#deleteConfirmModal').data('id', studentId);
                $('#deleteConfirmModal').modal('show');
            });
            
            // Confirm delete single student
            $('#confirmDeleteBtn').click(function () {
                const studentId = $('#deleteConfirmModal').data('id');
                
                $.ajax({
                    url: "{% url 'delete_student' %}",
                    type: "POST",
                    data: {
                        college_id: studentId,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.success) {
                            $('#deleteConfirmModal').modal('hide');
                            showMessage(response.message, 'success');
                            // Remove the student row from table
                            $(`#student-${studentId}`).remove();
                        } else {
                            showMessage(response.error, 'error');
                        }
                    },
                    error: function(xhr, status, error) {
                        showMessage('Error deleting student: ' + error, 'error');
                    }
                });
            });
            
            // Select all checkbox
            $('#selectAll').change(function () {
                $('.student-checkbox').prop('checked', this.checked);
            });
            
            // Edit selected students
            $('#editSelected').click(function () {
                const selectedIds = [];
                $('.student-checkbox:checked').each(function () {
                    selectedIds.push($(this).data('id'));
                });

                if (selectedIds.length === 0) {
                    showMessage('Please select at least one student to edit.', 'warning');
                    return;
                }
                
                $('#bulkEditIds').val(selectedIds.join(','));
                $('#bulkEditModal').modal('show');
            });
            
            // Save bulk edit
            $('#saveBulkEditBtn').click(function() {
                const formData = $('#bulkEditForm').serialize();
                
                $.ajax({
                    url: "{% url 'bulk_update_students' %}",
                    type: "POST",
                    data: formData,
                    success: function(response) {
                        if (response.success) {
                            $('#bulkEditModal').modal('hide');
                            showMessage(response.message, 'success');
                            loadStudents(currentPage);
                        } else {
                            showMessage(response.error, 'error');
                        }
                    },
                    error: function(xhr, status, error) {
                        showMessage('Error updating students: ' + error, 'error');
                    }
                });
            });
            
            // Delete selected students
            $('#deleteSelected').click(function () {
                const selectedIds = [];
                const selectedNames = [];

                $('.student-checkbox:checked').each(function () {
                    const id = $(this).data('id');
                    const name = $(this).closest('tr').find('td:eq(3)').text();
                    selectedIds.push(id);
                    selectedNames.push(name);
                });

                if (selectedIds.length === 0) {
                    showMessage('Please select at least one student to delete.', 'warning');
                    return;
                }

                let deleteListHtml = '<ul>';
                selectedNames.forEach(name => {
                    deleteListHtml += `<li>${name}</li>`;
                });
                deleteListHtml += '</ul>';

                $('#deleteStudentsList').html(deleteListHtml);
                $('#deleteConfirmModal').data('ids', selectedIds);
                $('#deleteConfirmModal').modal('show');
            });
            
            // Confirm bulk delete
            $(document).on('click', '#confirmDeleteBtn', function() {
                const studentIds = $('#deleteConfirmModal').data('ids');
                
                $.ajax({
                    url: "{% url 'bulk_delete_students' %}",
                    type: "POST",
                    data: {
                        student_ids: studentIds.join(','),
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.success) {
                            $('#deleteConfirmModal').modal('hide');
                            showMessage(response.message, 'success');
                            // Remove deleted students from table
                            studentIds.forEach(id => {
                                $(`#student-${id}`).remove();
                            });
                        } else {
                            showMessage(response.error, 'error');
                        }
                    },
                    error: function(xhr, status, error) {
                        showMessage('Error deleting students: ' + error, 'error');
                    }
                });
            });
            
            // Export selected students
            $('#exportSelected').click(function () {
                const selectedIds = [];
                $('.student-checkbox:checked').each(function () {
                    selectedIds.push($(this).data('id'));
                });

                if (selectedIds.length === 0) {
                    showMessage('Please select at least one student to export.', 'warning');
                    return;
                }
                
                // Create a form and submit it to trigger download
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'export_students' %}";
                
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = '{{ csrf_token }}';
                form.appendChild(csrfInput);
                
                const idsInput = document.createElement('input');
                idsInput.type = 'hidden';
                idsInput.name = 'student_ids';
                idsInput.value = selectedIds.join(',');
                form.appendChild(idsInput);
                
                document.body.appendChild(form);
                form.submit();
                document.body.removeChild(form);
            });
            
            // Show message function
            function showMessage(message, type) {
                const alertClass = type === 'success' ? 'alert-success' :
                    type === 'warning' ? 'alert-warning' :
                    type === 'info' ? 'alert-info' : 'alert-danger';

                const alertHtml = `
                    <div class="alert ${alertClass} alert-dismissible fade show">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                                      type === 'warning' ? 'fa-exclamation-triangle' : 
                                      type === 'info' ? 'fa-info-circle' : 'fa-exclamation-circle'}"></i>
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;

                $('#messageContainer').html(alertHtml);

                // Auto dismiss after 5 seconds
                setTimeout(() => {
                    $('.alert').alert('close');
                }, 5000);
            }
        });
    </script>
</body>
</html>