<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/attendance/studentView.css' %}">
</head>

<body>
    {% include "header.html" %}

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="animate__animated animate__fadeInDown">My Attendance</h1>
            <p class="animate__animated animate__fadeInUp">Track and monitor your attendance records</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="f-container">
        <div class="enroll-container">
            <div class="enroll-header">
                <h3>Attendance Overview</h3>
                <p class="mb-0">Detailed view of your attendance records</p>
            </div>

            <!-- Alert Messages -->
            {% if messages %}
            <div id="alertContainer">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show">
                    <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="student-info">
                <div class="info-card">
                    <h3><i class="fas fa-user"></i> Student Name</h3>
                    <p>{{ student.name }} {{ student.last_name }}</p>
                </div>
                <div class="info-card">
                    <h3><i class="fas fa-id-card"></i> College ID</h3>
                    <p>{{ student.college_id }}</p>
                </div>
                <div class="info-card">
                    <h3><i class="fas fa-book"></i> Course</h3>
                    <p>{{ student.course }}</p>
                </div>
                <div class="info-card">
                    <h3><i class="fas fa-calendar-alt"></i> Year/Semester</h3>
                    <p>Year {{ student.year }} / Sem {{ student.semester }}</p>
                </div>
            </div>

            {% if summary %}
            <div class="summary-cards">
                <div class="summary-card">
                    <h3><i class="fas fa-chalkboard-teacher"></i> Total Lectures</h3>
                    <p id="total-lectures">{{ summary.total_lectures }}</p>
                </div>
                <div class="summary-card">
                    <h3><i class="fas fa-check-circle"></i> Present</h3>
                    <p id="present-count">{{ summary.present }}</p>
                </div>
                <div class="summary-card">
                    <h3><i class="fas fa-times-circle"></i> Absent</h3>
                    <p id="absent-count">{{ summary.absent }}</p>
                </div>
                <div class="summary-card">
                    <h3><i class="fas fa-chart-line"></i> Attendance %</h3>
                    <p id="attendance-percent">{{ summary.attendance_percentage }}%</p>
                </div>
            </div>
            {% endif %}

            <div class="filter-section">
                <form id="filterForm" method="GET" action="{% url 'get_student_attendance' %}">
                    <input type="hidden" name="student_id" value="{{ student.id }}">
                    <div class="filter-group">
                        <label for="course"><i class="fas fa-book"></i> Course:</label>
                        <select id="course" name="course" class="form-select">
                            <option value="all">All Courses</option>
                            <option value="{{ student.course }}" selected>{{ student.course }}</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="month"><i class="fas fa-calendar"></i> Month:</label>
                        <select id="month" name="month" class="form-select">
                            <option value="all">All Months</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="year"><i class="fas fa-calendar-alt"></i> Year:</label>
                        <select id="year" name="year" class="form-select">
                            <option value="all">All Years</option>
                            {% for year in years %}
                            <option value="{{ year }}" {% if year == current_year %}selected{% endif %}>{{ year }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="status"><i class="fas fa-info-circle"></i> Status:</label>
                        <select id="status" name="status" class="form-select">
                            <option value="all">All Status</option>
                            <option value="Present">Present</option>
                            <option value="Absent">Absent</option>
                            <option value="Half Day">Half Day</option>
                            <option value="Leave">Leave</option>
                            <option value="Holiday">Holiday</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <button type="submit" class="btn-filter w-100">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                </form>
            </div>

            <div style="overflow-x: auto; padding: 20px;">
                {% if page_obj and page_obj.object_list %}
                <table class="attendance-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Day</th>
                            <th>Lecture</th>
                            <th>Course</th>
                            <th>Status</th>
                            <th>Marked By</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceData">
                        {% for detail in page_obj %}
                        <tr>
                            <td>{{ detail.date }}</td>
                            <td>{{ detail.date|date:"l" }}</td>
                            <td>{{ detail.lecture_number }}</td>
                            <td>{{ detail.course.name }}</td>
                            <td class="status-{{ detail.status|lower }}">{{ detail.status }}</td>
                            <td>Dr. {{ detail.faculty.name }}</td>
                            <td>{{ detail.timing }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <!-- Pagination -->
                <div class="pagination">
                    <span class="step-links">
                        {% if page_obj.has_previous %}
                            <a href="?page=1&student_id={{ student.id }}&course={{ request.GET.course }}&month={{ request.GET.month }}&year={{ request.GET.year }}&status={{ request.GET.status }}">&laquo; First</a>
                            <a href="?page={{ page_obj.previous_page_number }}&student_id={{ student.id }}&course={{ request.GET.course }}&month={{ request.GET.month }}&year={{ request.GET.year }}&status={{ request.GET.status }}">Previous</a>
                        {% endif %}
                        
                        <span class="current">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                        </span>
                        
                        {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}&student_id={{ student.id }}&course={{ request.GET.course }}&month={{ request.GET.month }}&year={{ request.GET.year }}&status={{ request.GET.status }}">Next</a>
                            <a href="?page={{ page_obj.paginator.num_pages }}&student_id={{ student.id }}&course={{ request.GET.course }}&month={{ request.GET.month }}&year={{ request.GET.year }}&status={{ request.GET.status }}">Last &raquo;</a>
                        {% endif %}
                    </span>
                </div>
                {% else %}
                <div class="no-records text-center py-5">
                    <i class="fas fa-search fa-2x mb-3"></i>
                    <p>No attendance records found for selected filters</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>