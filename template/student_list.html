<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Students Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
    }
    th { background: #eee; }
    button { cursor: pointer; }

    /* ðŸ”¹ Modal Background Blur */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    /* ðŸ”¹ Modal Box */
    .modal {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 350px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal h3 { margin-top: 0; }
    .modal button {
      margin: 10px;
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
    }
    .close-btn { background: #ccc; }
    .delete-btn { background: #e74c3c; color: white; }
    .confirm-btn { background: #e74c3c; color: white; }
    .cancel-btn { background: #ccc; }
  </style>
</head>
<body>
  <h2>Students List</h2>
  <table id="studentsTable">
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll"></th>
        <th>Roll No</th>
        <th>Name</th>
        <th>Course</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="deleteBtn">Delete Selected</button>

  <!-- ðŸ”¹ Student Detail Modal -->
  <div class="modal-overlay" id="detailModal">
    <div class="modal">
      <h3>Student Details</h3>
      <p><b>Roll No:</b> <span id="detailRoll"></span></p>
      <p><b>Name:</b> <span id="detailName"></span></p>
      <p><b>Course:</b> <span id="detailCourse"></span></p>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- ðŸ”¹ Delete Confirm Modal -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal">
      <h3>Are you sure?</h3>
      <p>This action will delete selected students.</p>
      <button class="confirm-btn" id="confirmDeleteBtn">Yes, Delete</button>
      <button class="cancel-btn" onclick="closeConfirm()">Cancel</button>
    </div>
  </div>

  <script>
    // Load Students
    function loadStudents() {
      fetch("/students/")
        .then(res => res.json())
        .then(data => {
          let rows = "";
          data.students.forEach(st => {
            rows += `<tr>
                      <td><input type="checkbox" class="studentChk" value="${st.roll_no}"></td>
                      <td>${st.roll_no}</td>
                      <td>${st.name}</td>
                      <td>${st.course}</td>
                      <td><button onclick="viewStudent(${st.roll_no})">View</button></td>
                     </tr>`;
          });
          document.querySelector("#studentsTable tbody").innerHTML = rows;
        });
    }
    loadStudents();

    // Select All
    document.getElementById("selectAll").addEventListener("change", function() {
      document.querySelectorAll(".studentChk").forEach(chk => chk.checked = this.checked);
    });

    // View Student (open modal)
    function viewStudent(roll_no) {
      fetch(`/students/${roll_no}/`)
        .then(res => res.json())
        .then(st => {
          if(st.error){
            alert(st.error);
          } else {
            document.getElementById("detailRoll").innerText = st.roll_no;
            document.getElementById("detailName").innerText = st.name;
            document.getElementById("detailCourse").innerText = st.course;
            document.getElementById("detailModal").style.display = "flex";
          }
        });
    }
    function closeModal() {
      document.getElementById("detailModal").style.display = "none";
    }

    // Delete Button -> open confirm modal
    document.getElementById("deleteBtn").addEventListener("click", function() {
      const selected = Array.from(document.querySelectorAll(".studentChk:checked"))
                        .map(chk => parseInt(chk.value));

      if (selected.length === 0) {
        alert("No students selected");
        return;
      }

      // Open confirm modal
      document.getElementById("confirmModal").style.display = "flex";

      // Confirm delete action
      document.getElementById("confirmDeleteBtn").onclick = function() {
        fetch("/students/delete_bulk/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ roll_nos: selected })
        })
        .then(res => res.json())
        .then(data => {
          closeConfirm();
          loadStudents();
          alert(data.message);
        });
      }
    });

    function closeConfirm() {
      document.getElementById("confirmModal").style.display = "none";
    }
  </script>
</body>
</html>
