<!DOCTYPE html>
<html>
<head>
    <title>Biometric Attendance</title>
</head>
<body>

<h2>Mark Attendance</h2>

<select id="lecture">
    <option value="ML">Machine Learning</option>
    <option value="AI">Artificial Intelligence</option>
</select>

<br><br>

<button onclick="verifyBiometric()">Verify & Mark Attendance</button>

<script>
async function verifyBiometric() {

    if (!window.PublicKeyCredential) {
        alert("Biometric not supported ❌");
        return;
    }

    const publicKey = {
        challenge: new Uint8Array(32),
        timeout: 60000,
        userVerification: "required"
    };

    try {
        await navigator.credentials.get({ publicKey });

        // biometric success → backend
        markAttendance();

    } catch {
        alert("Biometric Failed ❌");
    }
}

function markAttendance() {
    const lecture = document.getElementById("lecture").value;

    fetch("/attendance/save/", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "lecture=" + lecture
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("Attendance Marked ✅");
        } else {
            alert("Already Marked ❗");
        }
    });
}
</script>

</body>
</html>
