{% extends 'attendance/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card border-0 shadow-lg">
            <div class="card-body p-5">
                <!-- Success Animation -->
                <div class="text-center mb-4">
                    <div class="success-animation mb-3">
                        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" width="100" height="100">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                    </div>
                    
                    <h1 class="display-4 text-success fw-bold">
                        <i class="bi bi-check-circle-fill"></i>
                        Attendance Success!
                    </h1>
                    <p class="lead text-muted">Your attendance has been successfully recorded</p>
                </div>

                <!-- Success Details Card -->
                <div class="card border-success mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-clipboard-check"></i>
                            Attendance Confirmation
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-circle bg-primary me-3">
                                            <i class="bi bi-person-badge text-white"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted">College ID</small>
                                            <h5 class="mb-0">{{ employee.college_id }}</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-circle bg-info me-3">
                                            <i class="bi bi-person text-white"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted">Employee Name</small>
                                            <h5 class="mb-0">{{ employee.full_name }}</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center p-3">
                                    <div class="stat-icon mb-2">
                                        <i class="bi bi-clock-history fs-1 text-primary"></i>
                                    </div>
                                    <small class="text-muted">Time</small>
                                    <h4 class="mb-0">{{ timestamp|date:"h:i A" }}</h4>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center p-3">
                                    <div class="stat-icon mb-2">
                                        <i class="bi bi-calendar-check fs-1 text-success"></i>
                                    </div>
                                    <small class="text-muted">Date</small>
                                    <h4 class="mb-0">{{ timestamp|date:"d M Y" }}</h4>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center p-3">
                                    <div class="stat-icon mb-2">
                                        <i class="bi bi-shield-check fs-1 text-warning"></i>
                                    </div>
                                    <small class="text-muted">Status</small>
                                    <h4 class="mb-0">VERIFIED</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Message -->
                <div class="alert alert-info border-0">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="bi bi-info-circle-fill fs-4"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="alert-heading">
                                <i class="bi bi-shield-lock"></i>
                                Security Verified
                            </h5>
                            <p class="mb-0">
                                Your identity has been verified through 
                                {% if employee.fingerprint_enrolled %}
                                    <strong>Fingerprint Authentication</strong>
                                {% else %}
                                    <strong>PIN Verification</strong>
                                {% endif %}
                                . This attendance record is secure and tamper-proof.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card border-0 bg-light h-100">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-qr-code fs-1 text-primary mb-3"></i>
                                <h5>Save Confirmation</h5>
                                <p class="text-muted small">
                                    Take a screenshot of this page for your records
                                </p>
                                <button class="btn btn-outline-primary btn-sm" onclick="window.print()">
                                    <i class="bi bi-printer"></i> Print Receipt
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card border-0 bg-light h-100">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-clock fs-1 text-success mb-3"></i>
                                <h5>Next Attendance</h5>
                                <p class="text-muted small">
                                    Your next attendance can be marked after 8 hours
                                </p>
                                <div class="countdown-timer">
                                    <div class="timer-display">
                                        <span id="hours">08</span>:<span id="minutes">00</span>:<span id="seconds">00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center">
                    <div class="btn-group" role="group" aria-label="Success Actions">
                        <a href="{% url 'home' %}" class="btn btn-primary btn-lg px-4">
                            <i class="bi bi-house-door"></i> Go to Home
                        </a>
                        <a href="{% url 'verify_college_id' %}" class="btn btn-outline-primary btn-lg px-4">
                            <i class="bi bi-plus-circle"></i> Mark Another
                        </a>
                        <a href="{% url 'check_status' employee.college_id %}" class="btn btn-info btn-lg px-4">
                            <i class="bi bi-eye"></i> View Status
                        </a>
                    </div>
                </div>

                <!-- Footer Note -->
                <div class="text-center mt-4">
                    <p class="text-muted small">
                        <i class="bi bi-receipt"></i>
                        Confirmation ID: ATT{{ timestamp|date:"YmdHis" }}
                    </p>
                    <div class="alert alert-light border mt-3">
                        <small>
                            <i class="bi bi-exclamation-circle"></i>
                            This record has been logged in the system. Any discrepancies should be reported within 24 hours.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Success Animation Styles */
.success-animation {
    margin: 0 auto;
}

.checkmark {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: block;
    stroke-width: 2;
    stroke: #28a745;
    stroke-miterlimit: 10;
    box-shadow: inset 0px 0px 0px #28a745;
    animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
}

.checkmark__circle {
    stroke-dasharray: 166;
    stroke-dashoffset: 166;
    stroke-width: 2;
    stroke-miterlimit: 10;
    stroke: #28a745;
    fill: none;
    animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

.checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
}

@keyframes stroke {
    100% {
        stroke-dashoffset: 0;
    }
}

@keyframes scale {
    0%, 100% {
        transform: none;
    }
    50% {
        transform: scale3d(1.1, 1.1, 1);
    }
}

@keyframes fill {
    100% {
        box-shadow: inset 0px 0px 0px 30px #28a745;
    }
}

/* Custom Styles */
.icon-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.stat-icon {
    color: #6c757d;
}

.timer-display {
    font-family: 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: bold;
    background: #343a40;
    color: white;
    padding: 10px;
    border-radius: 5px;
    display: inline-block;
    min-width: 150px;
}

.info-item {
    padding: 15px;
    border-radius: 10px;
    background: #f8f9fa;
    transition: transform 0.3s;
}

.info-item:hover {
    transform: translateY(-2px);
    background: #e9ecef;
}

.btn-lg {
    padding: 12px 30px;
    font-size: 1.1rem;
    border-radius: 10px;
}

.alert-info {
    background: linear-gradient(45deg, #e3f2fd, #bbdefb);
    border-left: 5px solid #2196f3;
}
</style>

<script>
// Countdown Timer for next attendance (8 hours)
document.addEventListener('DOMContentLoaded', function() {
    // Set countdown to 8 hours from now
    let countDownDate = new Date().getTime() + (8 * 60 * 60 * 1000);
    
    // Update the count down every 1 second
    let x = setInterval(function() {
        // Get today's date and time
        let now = new Date().getTime();
        
        // Find the distance between now and the count down date
        let distance = countDownDate - now;
        
        // Time calculations for hours, minutes and seconds
        let hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        let minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        let seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        // Format with leading zeros
        hours = hours.toString().padStart(2, '0');
        minutes = minutes.toString().padStart(2, '0');
        seconds = seconds.toString().padStart(2, '0');
        
        // Display the result
        document.getElementById("hours").innerHTML = hours;
        document.getElementById("minutes").innerHTML = minutes;
        document.getElementById("seconds").innerHTML = seconds;
        
        // If the count down is finished, write some text
        if (distance < 0) {
            clearInterval(x);
            document.querySelector(".timer-display").innerHTML = "READY";
            document.querySelector(".timer-display").style.background = "#28a745";
        }
    }, 1000);
    
    // Auto redirect after 30 seconds (optional)
    setTimeout(function() {
        // Uncomment below to enable auto redirect
        // window.location.href = "{% url 'home' %}";
    }, 30000); // 30 seconds
});

// Print functionality
function printReceipt() {
    window.print();
}

// Copy confirmation ID
function copyConfirmationId() {
    const confirmationId = "ATT{{ timestamp|date:'YmdHis' }}";
    navigator.clipboard.writeText(confirmationId).then(() => {
        alert("Confirmation ID copied to clipboard!");
    });
}
</script>

{% endblock %}